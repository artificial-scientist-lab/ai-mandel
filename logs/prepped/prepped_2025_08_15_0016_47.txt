Thought: We can capture the SPA‐PT supermap as the heralded generation of its Choi–Jamiołkowski state on two qubits—i.e. a pure four-photon state on modes A₁,B₁,A₂,B₂ whose amplitudes realize Λ_SPA-PT on one pair and leave the second pair intact for CHSH. We then post-select on two ancilla clicks to herald the SPA channel application. Pytheus can optimize such heralded pure‐state preparation using its existing “target_state” + “amplitudes” machinery, number‐resolving detectors, and probabilistic pair sources. The second copy (for CHSH) can be routed straight to a standard Bell‐analyzer, which we simply leave as an output block. We set up a four‐photon target Choi state with amplitudes [p, √((1−p)/3),…] corresponding to a p‐weighted identity plus (1−p)‐weighted transpose; we choose p≈2/3 as in the standard SPA. Two ancilla detectors herald the run, and number‐resolving detectors ensure clean post‐selection. This fully static, heralded network is genuinely new in Pytheus—implementing a CP approximation to partial transpose and directly giving access to negativity—while leaving the second Bell pair for CHSH measurement “off‐circuit.”

Action: accept  
Action Input: 
{
  "description": "Heralded SPA-PT Choi-state preparation for direct negativity + CHSH test",
  "foldername": "spa_pt_negativity",
  "bulk_thr": 0.01,
  "edges_tried": 30,
  "ftol": 1e-06,
  "loss_func": "fid",
  "num_anc": 2,
  "num_pre": 1,
  "optimizer": "L-BFGS-B",
  "imaginary": false,
  "safe_hist": true,
  "samples": 50,
  "target_state": [
    "0000",  // |00>_A1B1 ⊗ |00>_A2B2  (identity component)
    "0110",  // |01>_A1B1 ⊗ |10>_A2B2  (transpose components)
    "1010",  // |10>_A1B1 ⊗ |10>_A2B2
    "1100"   // |11>_A1B1 ⊗ |00>_A2B2
  ],
  "amplitudes": [
    0.81649658,  // sqrt(p) with p=2/3
    0.47140452,  // sqrt((1−p)/3)
    0.47140452,
    0.47140452
  ],
  "in_nodes": [],
  "out_nodes": [],
  "thresholds": [0.1, 1.0],
  "heralding_out": true,
  "single_emitters": [],
  "removed_connections": [],
  "tries_per_edge": 5,
  "number_resolving": true,
  "anc_detectors": [4, 5]
}