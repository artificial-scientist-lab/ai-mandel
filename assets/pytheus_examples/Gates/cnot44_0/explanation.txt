In this example we create a heralded CNOT(4,4) gate, which means that we have a four-dimensional control photon and the gate acts on a four-dimensional target photon.

In this case the target photon always starts off in mode 0.

If the control photon is in mode 0, nothing happens to the target photon.
If the qubit is in mode 1, the target photons mode is changed to 1.
If the qubit is in mode 2, the target photons mode is changed to 2.
If the qubit is in mode 3, the target photons mode is changed to 3.

We express this transformation in the key word 'target_state'.

We can read the value for 'target_state'

    "0000" means |00> --> |00>
    "1011" means |10> --> |11>
    "2022" means |20> --> |22>
    "3033" means |30> --> |33>

the value for the keyword 'in_nodes' being [0,1] expresses that the first two numbers are the incoming particles.

the value for the keyword 'out_nodes' being [2,3] expresses that the third and fourth numbers are the outgoing particles.

This transformation requires six ancillary photons which are created from probabilistic photon pair sources.


We can visualize the setup in the following way (with the photons going from top to bottom):

incoming: [0 control qubit][1 target qutrit]
setup: [result of optimization, including spdc sources creating ancillary particles]
detectors: [2 out][3 out][anc. det.][anc. det.][anc. det.][anc. det.][anc. det.][anc. det.]

We set "heralding_out" to true so that the correct operation of the gate is signaled (heralded) when the ancillary detectors click. The threshold parameters (under "thresholds") and other entries (such as "bulk_thr", "loss_func", "optimizer", and "tries_per_edge") govern the optimization process. 