In this example we create a heralded Toffoli gate, which means that we have two control qubits acting on one target qubit.

If the control qubits are both in mode one, the target qubits mode is flipped.
In any other case the target photon stays unchanged.

We express this transformation in the key word 'target_state'.

We can read the value for 'target_state'

    "000000" means |000> -> |000>
    "010010" means |010> -> |010>
    "100100" means |100> -> |100>
    "110101" means |110> -> |111>
    "001001" means |001> -> |001>
    "011011" means |011> -> |011>
    "101101" means |101> -> |101>
    "111100" means |111> -> |110>

the value for the keyword 'in_nodes' being [0,1,2] expresses that the first three numbers are the incoming particles.

the value for the keyword 'out_nodes' being [3,4,5] expresses that the fourth, fifth and sixth number are the outgoing particles.

This transformation requires four ancillary photons which are created from probabilistic photon pair sources.

We can visualize the setup in the following way (with the photons going from top to bottom):

incoming: [0 control qubit][1 control qubit][2 target qutrit]
setup: [result of optimization, including spdc sources creating ancillary particles]
detectors: [3 out][4 out][5 out][anc. det.][anc. det.][anc. det.][anc. det.]

The keyword "number_resolving" is set to true which means that number resolving detectors are used.

We set "heralding_out" to true so that the correct operation of the gate is signaled (heralded) when the ancillary detectors click. The threshold parameters (under "thresholds") and other entries (such as "bulk_thr", "loss_func", "optimizer", and "tries_per_edge") govern the optimization process. 