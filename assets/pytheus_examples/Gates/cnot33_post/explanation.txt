In this example we create a post-selected CNOT(3,3) gate, which means that we have a control qutrit and the gate acts on a qutrit.

If the control qutrit is in mode 0, nothing happens to the target qutrit.
If the control qutrit is in mode 1, we add 1 (mod 3) to the mode of the target qutrit.
If the control qutrit is in mode 2, we add 2 (mod 3) to the mode of the target qutrit.


We express this transformation in the key word 'target_state'.

the value for the keyword 'in_nodes' being [0,1] expresses that the first two numbers are the incoming particles.

the value for the keyword 'out_nodes' being [2,3] expresses that the third and fourth numbers are the outgoing particles.

We can read the value for 'target_state'

    "0000" means |00> --> |00>
    "0101" means |01> --> |01>
    "0202" means |02> --> |02>
    "1011" means |10> --> |11>
    "1112" means |11> --> |12>
    "1210" means |12> --> |10>
    "2022" means |20> --> |22>
    "2120" means |21> --> |20>
    "2221" means |22> --> |21>

This transformation requires two ancillary photons which are created from probabilistic pair sources.

We can visualize the setup in the following way (with the photons going from top to bottom):

incoming: [0 control qubit][1 target qutrit]
setup: [result of optimization, including spdc sources creating ancillary particles]
detectors: [2 out][3 out][anc. det.][anc. det.]

We set "heralding_out" to null (default is false) so for the correct operation of the gate all detectors (output detectors and ancilla detectors) have to click. The threshold parameters (under "thresholds") and other entries (such as "bulk_thr", "loss_func", "optimizer", and "tries_per_edge") govern the optimization process. 