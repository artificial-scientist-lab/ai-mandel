In this example we create a post-selected controlled Z gate, which means that we have a control qubit acting on a target qubit.

If the control photon is in mode 0, nothing happens to the target photon.
If the qubit is in mode 1, the target photon is given a phase shift of pi.

We express this transformation in the key word 'target_state' and 'amplitudes'.

We can read the value for 'target_state'

    "0000" means |00> --> |00>
    "0101" means |01> --> |01>
    "1010" means |10> --> |10>
    "1111" means |11> --> |11>

The value of 'amplitudes' is [1.0,1.0,1.0,-1.0]. The ket transformations above are multiplied by these factors. This describes the following transformation:

    |00> --> |00>
    |01> --> |01>
    |10> --> |10>
    |11> --> (-1)*|11>

the value for the keyword 'in_nodes' being [0,1] expresses that the first two numbers are the incoming particles.

the value for the keyword 'out_nodes' being [2,3] expresses that the third and fourth numbers are the outgoing particles.

This transformation requires one ancillary photon which is created from a single-photon emitter.

We introduce the single photon emitter with the keyword "single_emitters".

We can visualize the setup in the following way (with the photons going from top to bottom):

incoming: [0 control qubit][1 target qutrit][4 anc. sps]
setup: [result of optimization]
detectors: [2 out][3 out][anc. det.][anc. det.]

The keyword "number_resolving" is set to true which means that number resolving detectors are used.

We set "heralding_out" to false so for the correct operation of the gate all detectors (output detectors and ancilla detectors) have to click. The threshold parameters (under "thresholds") and other entries (such as "bulk_thr", "loss_func", "optimizer", and "tries_per_edge") govern the optimization process. 