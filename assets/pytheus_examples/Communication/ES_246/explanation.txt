In this example we create entanglement between two photons with four modes.
We want the created photons to be entangled in a four dimensional Bell state

Psi = |00>+|11>+|22>+|33> (without normalization)

The setup we are optimizing for here is constructed from probabilistic photon pair sources.

The setup to create this state would usually have a relatively simple layout (with four probabilistic pair sources creating the correlated photons), but we want to create this state in a way that is inspired by entanglement swapping.

We can visualize the setup in the following way (with the photons going from top to bottom):
setup of photon pair sources: [elements to be optimized]
detectors: [0][1][anc. det.][anc. det.][anc. det.][anc. det.]
there are four ancillary detectors as specified by 'num_anc'.

In the context of probabilistic photon-pair sources, the keyword 'removed_connections' excludes sources emitting to the specified pairs of detectors. Therefore the corresponding value is [0, 1] as the photons 0 and 1 (making up the final 3d Bell state) should have no common source

The ancillary particles are measured by a third party, similar to the standard entanglement swapping experiment (entangling two qubits).